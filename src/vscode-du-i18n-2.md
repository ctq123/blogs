# 从vscode插件的角度看国际多语言一体化建设（下）

上一篇我们从vscode插件建设的角度介绍了目前多语言本地开发模式的痛点和解决方案，今天我们会从线上开发的模式跟大家分享一下从vscode插件的角度看国际多语言解决方案。

本文主要分四个部分，一是国际化多语言解决方案的探讨，二是目前的痛点分析以及目标，三是vscode插件提供的支持，四是本文的总结以及未来展望。

## 国际化多语言解决方案
首先来聊一聊目前实现国际多语言的几种解决方案
- 调用机器翻译API
- i18n
- react-intl
- 本地自动化翻译
- 翻译平台

#### 1）调用机器翻译API
首先是调用机器翻译API，比较经典就是调用google，有道，百度等提供出来的API接口，这种方案优点是相对比较简单且快捷。比如调用google翻译的API：

```html
<div id="google_translate_element"></div>
<script>
function googleTranslateElementInit() {
	new google.translate.TranslateElement({pageLanguage: 'zh-CN'}, 'google_translate_element');
	}
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
```

当然它也有对应的node端服务。这种方式的缺点也很明显，准确率不达标，过于简单和机械，对公司内部的术语往往束手无策。同时，翻墙和收费等问题也是需要考虑的因素。因此这种方案通常只作为机器翻译用于参考。
- 优点：简单快捷
- 缺点：准确率不达标，过于简单和机械
> tips：目前谷歌已暂停提供这种接口服务，但不影响已使用该服务的网站，新的应用无法使用该服务

#### 2）i18n
它的全称为internationalization，意为国际化，取首尾字母+字母个数的形式缩写为i18n。它应该是目前最流行的一套解决方案，在vue应用中绝对处于垄断的地位，当然它不仅仅局限于vue应用，react，小程序和移动端都支持。它适合定制化的应用，翻译的效果也是杠杠的，缺点是不够智能化，扩展性也相对较弱。
- 优点：通用流行，定制化强
- 缺点：不够智能化，扩展性也相对较弱

#### 3）react-intl
它跟i18n有点类似，但它有一定的局限性，往往只有react应用可以使用，也是一种定制化的解决方案，优缺点与i18n相当，但它的跨端和跨语言相对i18n要弱。
- 优点：通用流行，定制化强
- 缺点：使用局限性，针对react

#### 4）本地自动化翻译
这种技术方案其实只是在i18n和react-intl上进行一层优化，技术的本质上并没有变，只是利用插件(webpack/vscode/node等)对项目文件进行扫描，提取文件中的文字进行提取和替换，自动生成源文件保存在本地，再根据源文件翻译各种目标语言文件。它的优点是自动化，无需人为干预，缺点是入侵代码，代码质量存在隐患，并且只能处理文字，针对不同的语言不同的css样式无法处理。
- 优点：自动化扫描替换，开发无需过多地编写多语言代码
- 缺点：入侵代码，存在质量隐患

#### 5）翻译平台
翻译平台分为外部翻译平台和内部翻译平台，顾名思义，外部翻译平台通常都要付费才能享受，而内部翻译平台通常需要一定的研发成本和精力。它们一般都具备较强的扩展性和兼容性，集成效果也相对较好，不再受限于某个领域，而是从产品研发链路上考虑的一站式解决方案，整体研发成本和效率上会有显著的提高。外部翻译平台是相对普遍性，针对性相对较弱，往往不是最优解决方案；而内部翻译平台针对性会相对比较强，通常是某个行业内或者公司内部的最佳应用，并且掌握定制化的自主权。
- 优点：支持热更新，定制性较强，跨端处理能力强
- 缺点：涉及面广，影响较大

## 痛点分析
那么目前多语言研发链路上的痛点有哪些呢？
- **产品业务线多，多语言资料不好管理，更无法共享**
- **文案变动更新麻烦，各业务线大多只能手动更新，不支持热更新**
- **翻译员工作任务繁重，无法很好地提供参照值，术语库也只能线下维护**
- **研发流程繁琐，语言文案通常是一对多的关系，增删改任务简单却繁琐低效**

根据目前多语言产品的痛点，个人认为国际多语言平台应该承担的职责主要有三个方面：
**1）多语言文案产出**：为web端，App客户端(IOS/Android/Flutter/RN)，小程序等多种应用在线提供多语言文案支持。
**2）物料管理**：为翻译员提供的多语言物料，包括设计图的输入，翻译编辑器，机器翻译参考库，专业术语库，高频词汇库，记忆库，文案纠错，为翻译员提供更加便捷的服务，并为多个项目之间实现共享和复制功能提供支持。
**3）产品研发服务**：为产品的多语言项目的研发流程管理，翻译任务的管理，翻译内容的管理和发布提供一站式服务。为产品，翻译员，研发人员在项目中所承担的任务提供管理服务。

![图片](https://cdn.poizon.com/node-common/2c85448dab23091a9e50e3dc34caf86b.png)

目前国际多语言平台的建设已完成第一阶段的开发，实现了对web端的支持以及对应的SDK，具体的实现后续由文瑞和其他队员来介绍，这里就不再重复介绍了。本文只从vscode插件的角度分析对国际多语言解决方案的实践和探索。

## vscode插件的支持
针对在线多语言研发平台第一阶段的开发，vscode插件提供的支持包括
- 支持本地语言预览
- 支持配置化，满足目前及未来的不同场景
- 支持在线环境切换
- 支持显示语言切换
- 支持输入自动补全
- 支持在线更新本地数据

1）预览效果
![图片](https://cdn.poizon.com/node-common/a5e7054ea6f7651a42b176d5f95b74aa.png)

2）支持输入自动补全以及key值预览
![图片](https://cdn.poizon.com/node-common/757f45b33254ecf0556a9360c6411db6.png)

3）支持环境切换
![图片](https://cdn.poizon.com/node-common/6fe6bd2ec4f102a961282a990d888318.png)
![图片](https://cdn.poizon.com/node-common/8699255091b695dc5abec732dcea3117.png)

4）支持语言切换
![图片](https://cdn.poizon.com/node-common/253a09dc91b13ed3f617f50a4fd0f5a9.png)
![图片](https://cdn.poizon.com/node-common/6dfc2d6148cb3814225491410a035893.png)

5）支持同步更新在线数据到本地
![图片](https://cdn.poizon.com/node-common/d58a602e585e2041c0aecd989ecccfca.png)

## 总结

其实通过插件或者SDK可以直接扫描项目中i18n的引用，然后将识别到的原语言文案自动上传至多语言平台，实现一键换新的效果。但由此会引发另外一个问题，测试回归难的问题，由于目前测试资源是非常紧张的，所以为保障系统的稳定性采用渐进方式进行替换。

目前第一阶段的多语言平台建设只针对web端，未来对多端打通以及物料管理还有很多工作任务需要处理。

为保障系统的稳定性，目前多端打通最简单的一步是支持文案的导出，例如针对IOS需要支持srings格式，Android需要支持xml格式。

本文主要从vscode插件开发的角度谈了一些对国际多语言平台建设的思路，国际多语言平台有它独到的优点，但也会引发一系列的问题，如兜底方案的处理，自动化测试回归的处理等等都是值得我们思考和解决的问题。

